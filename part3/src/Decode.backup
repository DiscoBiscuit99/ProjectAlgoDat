import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;

public class Decode {

    public static void main( String[] args ) {

        if ( args.length < 2 ) {

            System.out.println( "The name of the file to decompressed and the new decompressed file must be given..." );
            System.exit( 1 );

        }

        int[] frequencies = decode( args[ 0 ], args[ 1 ] );

    }

    private static int[] decode( String filenameCompressed, String filenameDecompressed ) {

        int[] frequencies = new int[ 256 ];

        try {

            File compressed = new File( filenameCompressed );
            File decompressed = new File( filenameDecompressed );

            FileInputStream fiStream = new FileInputStream( compressed );
            BitInputStream biStream = new BitInputStream( fiStream );

            FileOutputStream foStream = new FileOutputStream( decompressed );

            int total = 0;
            for ( int i = 0; i < frequencies.length; i++ ) {

                int frequency = biStream.readInt();

                total += frequency;
                frequencies[ i ] = frequency;

            }

            Huffman ht = new Huffman();
            ht.constructTree( frequencies );

            String[] codewords = ht.constructCodes();

            Element currentNode = ht.root();

            int b = 0;
            while ( b != -1 ) {

                b = biStream.readBit();

                switch ( b ) {

                    case 0:

                        if ( currentNode.data() instanceof Node )
                            currentNode = (Element) ( (Node) currentNode.data() ).left();

                        if ( currentNode.data() instanceof Character ) {

                            char c = (char) currentNode.data();
                            foStream.write( c );
                            currentNode = ht.root();

                        }

                        break;

                    case 1:

                        if ( currentNode.data() instanceof Node )
                            currentNode = (Element) ( (Node) currentNode.data() ).right();

                        if ( currentNode.data() instanceof Character ) {

                            char c = (char) currentNode.data();
                            foStream.write( c );
                            currentNode = ht.root();

                        }

                        break;

                }

            }

            biStream.close();

        } catch ( IOException e ) {
            
            e.printStackTrace();

        }

        return frequencies;

    }

}

